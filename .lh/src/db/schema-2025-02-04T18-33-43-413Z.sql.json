{
    "sourceFile": "src/db/schema-2025-02-04T18-33-43-413Z.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1739014925007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1739014972109,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,8 +13,9 @@\n   created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),\n   updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),\n   user_id uuid,\n   order_index bigint NOT NULL,\n+  voice_id uuid REFERENCES voices(id),\n   CONSTRAINT exercise_prompts_pkey PRIMARY KEY,\n   CONSTRAINT exercise_prompts_question_id_fkey FOREIGN KEY,\n   CONSTRAINT exercise_prompts_type_check CHECK,\n   CONSTRAINT exercise_prompts_user_id_fkey FOREIGN KEY,\n@@ -373,8 +374,9 @@\n   user_id uuid,\n   prerequisites ARRAY DEFAULT '{}'::uuid[],\n   total_topics integer DEFAULT 0,\n   difficulty character varying DEFAULT 'beginner'::character varying,\n+  voice_id uuid REFERENCES voices(id),\n   CONSTRAINT lessons_grade_id_fkey FOREIGN KEY,\n   CONSTRAINT lessons_pkey PRIMARY KEY,\n   CONSTRAINT lessons_subtopic_id_fkey FOREIGN KEY,\n   CONSTRAINT lessons_topic_id_fkey FOREIGN KEY,\n@@ -435,8 +437,9 @@\n   data jsonb NOT NULL DEFAULT '{}'::jsonb,\n   correct_answer text,\n   user_id uuid,\n   exercise_prompts ARRAY DEFAULT ARRAY[]::jsonb[],\n+  voice_id uuid REFERENCES voices(id),\n   CONSTRAINT questions_lesson_id_fkey FOREIGN KEY,\n   CONSTRAINT questions_pkey PRIMARY KEY,\n   CONSTRAINT questions_user_id_fkey FOREIGN KEY,\n   CONSTRAINT 2200_50362_1_not_null CHECK,\n@@ -753,8 +756,9 @@\n   instructions text,\n   data jsonb DEFAULT jsonb_build_object('prompt', '', 'teacherScript', '', 'media', ARRAY[]::text[]),\n   media ARRAY DEFAULT ARRAY[]::jsonb[],\n   order_index bigint NOT NULL,\n+  voice_id uuid REFERENCES voices(id),\n   CONSTRAINT activities_lesson_id_fkey FOREIGN KEY,\n   CONSTRAINT activities_pkey PRIMARY KEY,\n   CONSTRAINT activities_type_check CHECK,\n   CONSTRAINT 2200_52772_1_not_null CHECK,\n@@ -1053,8 +1057,63 @@\n   CONSTRAINT 2200_36877_8_not_null CHECK,\n   CONSTRAINT 2200_36877_9_not_null CHECK\n );\n \n+-- Table: voices\n+CREATE TABLE IF NOT EXISTS voices (\n+  id uuid NOT NULL DEFAULT gen_random_uuid(),\n+  name text NOT NULL,\n+  description text,\n+  language text NOT NULL,\n+  gender text NOT NULL CHECK (gender IN ('male', 'female')),\n+  sample_url text NOT NULL,\n+  is_default boolean DEFAULT false,\n+  school_id uuid NOT NULL,\n+  created_at timestamp with time zone DEFAULT now(),\n+  updated_at timestamp with time zone DEFAULT now(),\n+  CONSTRAINT voices_pkey PRIMARY KEY (id),\n+  CONSTRAINT voices_school_id_fkey FOREIGN KEY (school_id) REFERENCES schools(id),\n+  CONSTRAINT voices_school_id_is_default_key UNIQUE (school_id, is_default) \n+    WHERE is_default = true -- Only one default voice per school\n+);\n+\n+-- Create indexes for voices\n+CREATE INDEX IF NOT EXISTS idx_voices_school_id ON voices(school_id);\n+CREATE INDEX IF NOT EXISTS idx_voices_is_default ON voices(is_default);\n+\n+-- Add voice_id to lessons table\n+ALTER TABLE lessons ADD COLUMN IF NOT EXISTS voice_id uuid REFERENCES voices(id);\n+\n+-- Add voice_id to activities table\n+ALTER TABLE activities ADD COLUMN IF NOT EXISTS voice_id uuid REFERENCES voices(id);\n+\n+-- Add voice_id to questions table\n+ALTER TABLE questions ADD COLUMN IF NOT EXISTS voice_id uuid REFERENCES voices(id);\n+\n+-- Add voice_id to exercise_prompts table\n+ALTER TABLE exercise_prompts ADD COLUMN IF NOT EXISTS voice_id uuid REFERENCES voices(id);\n+\n+-- Create function to ensure only one default voice per school\n+CREATE OR REPLACE FUNCTION ensure_single_default_voice()\n+RETURNS TRIGGER AS $$\n+BEGIN\n+  IF NEW.is_default THEN\n+    UPDATE voices\n+    SET is_default = false\n+    WHERE school_id = NEW.school_id\n+      AND id != NEW.id\n+      AND is_default = true;\n+  END IF;\n+  RETURN NEW;\n+END;\n+$$ LANGUAGE plpgsql;\n+\n+-- Create trigger for voices table\n+CREATE TRIGGER ensure_single_default_voice_trigger\n+BEFORE INSERT OR UPDATE ON voices\n+FOR EACH ROW\n+EXECUTE FUNCTION ensure_single_default_voice();\n+\n -- New Tables for AI Integration\n \n -- Table: ai_conversations\n CREATE TABLE IF NOT EXISTS ai_conversations (\n"
                }
            ],
            "date": 1739014925007,
            "name": "Commit-0",
            "content": "-- Database Schema Export\n-- Generated at: 2025-02-04T18:33:29.037Z\n\n-- Table: exercise_prompts\nCREATE TABLE IF NOT EXISTS exercise_prompts (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  text text NOT NULL,\n  media text,\n  type text,\n  narration text,\n  saytext text,\n  question_id uuid,\n  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),\n  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),\n  user_id uuid,\n  order_index bigint NOT NULL,\n  CONSTRAINT exercise_prompts_pkey PRIMARY KEY,\n  CONSTRAINT exercise_prompts_question_id_fkey FOREIGN KEY,\n  CONSTRAINT exercise_prompts_type_check CHECK,\n  CONSTRAINT exercise_prompts_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_55306_1_not_null CHECK,\n  CONSTRAINT 2200_55306_2_not_null CHECK,\n  CONSTRAINT 2200_55306_8_not_null CHECK,\n  CONSTRAINT 2200_55306_9_not_null CHECK,\n  CONSTRAINT 2200_55306_11_not_null CHECK\n);\n\n-- Table: students\nCREATE TABLE IF NOT EXISTS students (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  last_name text NOT NULL,\n  roll_number text NOT NULL,\n  school_id uuid,\n  grade_id uuid,\n  gender text,\n  date_of_birth date,\n  contact_number text,\n  email text,\n  address text,\n  guardian_name text,\n  guardian_contact text,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  first_name text,\n  CONSTRAINT fk_student_grade FOREIGN KEY,\n  CONSTRAINT students_gender_check CHECK,\n  CONSTRAINT students_pkey PRIMARY KEY,\n  CONSTRAINT students_school_id_fkey FOREIGN KEY,\n  CONSTRAINT students_school_id_roll_number_key UNIQUE,\n  CONSTRAINT 2200_30925_1_not_null CHECK,\n  CONSTRAINT 2200_30925_2_not_null CHECK,\n  CONSTRAINT 2200_30925_3_not_null CHECK\n);\n\n-- Table: sales_leads\nCREATE TABLE IF NOT EXISTS sales_leads (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  company_name text NOT NULL,\n  contact_name text NOT NULL,\n  email text NOT NULL,\n  phone text,\n  status text NOT NULL,\n  source text,\n  assigned_to uuid,\n  estimated_value numeric,\n  probability integer,\n  expected_close_date date,\n  notes text,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT sales_leads_assigned_to_fkey FOREIGN KEY,\n  CONSTRAINT sales_leads_pkey PRIMARY KEY,\n  CONSTRAINT sales_leads_probability_check CHECK,\n  CONSTRAINT sales_leads_status_check CHECK,\n  CONSTRAINT 2200_29964_1_not_null CHECK,\n  CONSTRAINT 2200_29964_2_not_null CHECK,\n  CONSTRAINT 2200_29964_3_not_null CHECK,\n  CONSTRAINT 2200_29964_4_not_null CHECK,\n  CONSTRAINT 2200_29964_6_not_null CHECK\n);\n\n-- Table: sales_activities\nCREATE TABLE IF NOT EXISTS sales_activities (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  lead_id uuid,\n  type text NOT NULL,\n  subject text NOT NULL,\n  description text,\n  status text,\n  due_date timestamp with time zone,\n  completed_at timestamp with time zone,\n  performed_by uuid,\n  created_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT sales_activities_lead_id_fkey FOREIGN KEY,\n  CONSTRAINT sales_activities_performed_by_fkey FOREIGN KEY,\n  CONSTRAINT sales_activities_pkey PRIMARY KEY,\n  CONSTRAINT sales_activities_status_check CHECK,\n  CONSTRAINT sales_activities_type_check CHECK,\n  CONSTRAINT 2200_29981_1_not_null CHECK,\n  CONSTRAINT 2200_29981_3_not_null CHECK,\n  CONSTRAINT 2200_29981_4_not_null CHECK\n);\n\n-- Table: sales_opportunities\nCREATE TABLE IF NOT EXISTS sales_opportunities (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  lead_id uuid,\n  name text NOT NULL,\n  stage text NOT NULL,\n  amount numeric,\n  close_date date,\n  probability integer,\n  next_step text,\n  competition text,\n  notes text,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT sales_opportunities_lead_id_fkey FOREIGN KEY,\n  CONSTRAINT sales_opportunities_pkey PRIMARY KEY,\n  CONSTRAINT sales_opportunities_probability_check CHECK,\n  CONSTRAINT sales_opportunities_stage_check CHECK,\n  CONSTRAINT 2200_30002_1_not_null CHECK,\n  CONSTRAINT 2200_30002_3_not_null CHECK,\n  CONSTRAINT 2200_30002_4_not_null CHECK\n);\n\n-- Table: user_preferences\nCREATE TABLE IF NOT EXISTS user_preferences (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  user_id uuid,\n  preferences jsonb DEFAULT '{}'::jsonb,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT user_preferences_pkey PRIMARY KEY,\n  CONSTRAINT user_preferences_user_id_fkey FOREIGN KEY,\n  CONSTRAINT user_preferences_user_id_key UNIQUE,\n  CONSTRAINT 2200_30151_1_not_null CHECK\n);\n\n-- Table: sales_contacts\nCREATE TABLE IF NOT EXISTS sales_contacts (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  lead_id uuid,\n  name text NOT NULL,\n  title text,\n  email text,\n  phone text,\n  is_primary boolean DEFAULT false,\n  department text,\n  notes text,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT sales_contacts_lead_id_fkey FOREIGN KEY,\n  CONSTRAINT sales_contacts_pkey PRIMARY KEY,\n  CONSTRAINT 2200_30019_1_not_null CHECK,\n  CONSTRAINT 2200_30019_3_not_null CHECK\n);\n\n-- Table: user_schools\nCREATE TABLE IF NOT EXISTS user_schools (\n  user_id uuid NOT NULL,\n  school_id uuid NOT NULL,\n  CONSTRAINT user_schools_pkey PRIMARY KEY,\n  CONSTRAINT user_schools_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_29173_1_not_null CHECK,\n  CONSTRAINT 2200_29173_2_not_null CHECK\n);\n\n-- Table: dashboards\nCREATE TABLE IF NOT EXISTS dashboards (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  user_id uuid,\n  name text NOT NULL,\n  layout jsonb NOT NULL DEFAULT '[]'::jsonb,\n  is_default boolean DEFAULT false,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT dashboards_pkey PRIMARY KEY,\n  CONSTRAINT dashboards_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_30970_1_not_null CHECK,\n  CONSTRAINT 2200_30970_3_not_null CHECK,\n  CONSTRAINT 2200_30970_4_not_null CHECK\n);\n\n-- Table: schools\nCREATE TABLE IF NOT EXISTS schools (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  name text NOT NULL,\n  type text NOT NULL,\n  parent_id uuid,\n  address text NOT NULL,\n  latitude double precision NOT NULL,\n  longitude double precision NOT NULL,\n  contact_number text NOT NULL,\n  email text NOT NULL,\n  status text NOT NULL,\n  capacity integer NOT NULL,\n  principal_name text NOT NULL,\n  website text,\n  established_year integer,\n  accreditation_status text,\n  facilities jsonb DEFAULT '{}'::jsonb,\n  operating_hours jsonb DEFAULT '{}'::jsonb,\n  social_media jsonb DEFAULT '{}'::jsonb,\n  emergency_contact text,\n  tax_id text,\n  license_number text,\n  last_inspection_date date,\n  student_count integer DEFAULT 0,\n  staff_count integer DEFAULT 0,\n  classroom_count integer DEFAULT 0,\n  is_boarding boolean DEFAULT false,\n  transportation_provided boolean DEFAULT false,\n  curriculum_type ARRAY DEFAULT '{}'::text[],\n  languages_offered ARRAY DEFAULT '{}'::text[],\n  extracurricular_activities ARRAY DEFAULT '{}'::text[],\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  grades ARRAY DEFAULT '{}'::text[],\n  school_type USER-DEFINED NOT NULL DEFAULT 'public'::school_category,\n  school_level USER-DEFINED NOT NULL DEFAULT 'elementary'::school_level,\n  classes ARRAY DEFAULT '{}'::jsonb[],\n  academic_year_start date,\n  academic_year_end date,\n  school_timings jsonb DEFAULT '{\"friday\": {\"end\": \"12:00\", \"start\": \"08:00\"}, \"regular\": {\"end\": \"15:00\", \"start\": \"08:00\"}}'::jsonb,\n  academic_calendar jsonb DEFAULT '{\"terms\": [], \"events\": [], \"holidays\": []}'::jsonb,\n  grade_structure jsonb DEFAULT '{\"high\": {\"grades\": [], \"sections\": []}, \"middle\": {\"grades\": [], \"sections\": []}, \"elementary\": {\"grades\": [], \"sections\": []}}'::jsonb,\n  supported_languages ARRAY DEFAULT '{}'::text[],\n  academic_programs jsonb DEFAULT '{\"gifted\": false, \"regular\": true, \"vocational\": false, \"specialNeeds\": false}'::jsonb,\n  assessment_system jsonb DEFAULT '{\"grading\": \"percentage\", \"passingScore\": 40, \"assessmentTypes\": []}'::jsonb,\n  teaching_methodologies ARRAY DEFAULT '{}'::text[],\n  academic_policies jsonb DEFAULT '{}'::jsonb,\n  class_size_limits jsonb DEFAULT '{\"max\": 30, \"min\": 15}'::jsonb,\n  CONSTRAINT check_capacity CHECK,\n  CONSTRAINT check_email CHECK,\n  CONSTRAINT check_latitude CHECK,\n  CONSTRAINT check_longitude CHECK,\n  CONSTRAINT schools_parent_id_fkey FOREIGN KEY,\n  CONSTRAINT schools_pkey PRIMARY KEY,\n  CONSTRAINT schools_status_check CHECK,\n  CONSTRAINT schools_type_check CHECK,\n  CONSTRAINT 2200_29207_1_not_null CHECK,\n  CONSTRAINT 2200_29207_2_not_null CHECK,\n  CONSTRAINT 2200_29207_3_not_null CHECK,\n  CONSTRAINT 2200_29207_5_not_null CHECK,\n  CONSTRAINT 2200_29207_6_not_null CHECK,\n  CONSTRAINT 2200_29207_7_not_null CHECK,\n  CONSTRAINT 2200_29207_8_not_null CHECK,\n  CONSTRAINT 2200_29207_9_not_null CHECK,\n  CONSTRAINT 2200_29207_10_not_null CHECK,\n  CONSTRAINT 2200_29207_11_not_null CHECK,\n  CONSTRAINT 2200_29207_12_not_null CHECK,\n  CONSTRAINT 2200_29207_34_not_null CHECK,\n  CONSTRAINT 2200_29207_35_not_null CHECK\n);\n\n-- Table: school_grades\nCREATE TABLE IF NOT EXISTS school_grades (\n  school_id uuid NOT NULL,\n  grade_id uuid NOT NULL,\n  created_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT school_grades_pkey PRIMARY KEY,\n  CONSTRAINT school_grades_school_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_29235_1_not_null CHECK,\n  CONSTRAINT 2200_29235_2_not_null CHECK\n);\n\n-- Table: staff\nCREATE TABLE IF NOT EXISTS staff (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  name text NOT NULL,\n  email text NOT NULL,\n  role text NOT NULL,\n  school_id uuid,\n  department text,\n  status text NOT NULL DEFAULT 'active'::text,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT staff_email_key UNIQUE,\n  CONSTRAINT staff_pkey PRIMARY KEY,\n  CONSTRAINT staff_school_id_fkey FOREIGN KEY,\n  CONSTRAINT staff_status_check CHECK,\n  CONSTRAINT 2200_39454_1_not_null CHECK,\n  CONSTRAINT 2200_39454_2_not_null CHECK,\n  CONSTRAINT 2200_39454_3_not_null CHECK,\n  CONSTRAINT 2200_39454_4_not_null CHECK,\n  CONSTRAINT 2200_39454_7_not_null CHECK\n);\n\n-- Table: grades\nCREATE TABLE IF NOT EXISTS grades (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  name character varying NOT NULL,\n  level integer NOT NULL,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT grades_pkey PRIMARY KEY,\n  CONSTRAINT 2200_48870_1_not_null CHECK,\n  CONSTRAINT 2200_48870_2_not_null CHECK,\n  CONSTRAINT 2200_48870_3_not_null CHECK\n);\n\n-- Table: topics\nCREATE TABLE IF NOT EXISTS topics (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  title character varying NOT NULL,\n  description text,\n  grade_id uuid NOT NULL,\n  order_index integer,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  course_id uuid,\n  CONSTRAINT topics_course_id_fkey FOREIGN KEY,\n  CONSTRAINT topics_grade_id_fkey FOREIGN KEY,\n  CONSTRAINT topics_pkey PRIMARY KEY,\n  CONSTRAINT 2200_48878_1_not_null CHECK,\n  CONSTRAINT 2200_48878_2_not_null CHECK,\n  CONSTRAINT 2200_48878_4_not_null CHECK\n);\n\n-- Table: subtopics\nCREATE TABLE IF NOT EXISTS subtopics (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  title character varying NOT NULL,\n  description text,\n  topic_id uuid NOT NULL,\n  order_index integer,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  name text,\n  CONSTRAINT subtopics_pkey PRIMARY KEY,\n  CONSTRAINT subtopics_topic_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_48893_1_not_null CHECK,\n  CONSTRAINT 2200_48893_2_not_null CHECK,\n  CONSTRAINT 2200_48893_4_not_null CHECK\n);\n\n-- Table: lesson_content\nCREATE TABLE IF NOT EXISTS lesson_content (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  lesson_id uuid,\n  content_type character varying,\n  metadata jsonb,\n  order_index integer,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  user_id uuid,\n  content ARRAY,\n  created_at timestamp with time zone,\n  CONSTRAINT lesson_content_lesson_id_fkey FOREIGN KEY,\n  CONSTRAINT lesson_content_pkey PRIMARY KEY,\n  CONSTRAINT lesson_content_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_48934_1_not_null CHECK\n);\n\n-- Table: lessons\nCREATE TABLE IF NOT EXISTS lessons (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  title character varying NOT NULL,\n  content text,\n  grade_id uuid,\n  topic_id uuid,\n  subtopic_id uuid NOT NULL,\n  order_index integer,\n  status character varying DEFAULT 'draft'::character varying,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  description text,\n  media_type USER-DEFINED,\n  media_url text,\n  duration bigint,\n  subjectId text,\n  contentheading text,\n  user_id uuid,\n  prerequisites ARRAY DEFAULT '{}'::uuid[],\n  total_topics integer DEFAULT 0,\n  difficulty character varying DEFAULT 'beginner'::character varying,\n  CONSTRAINT lessons_grade_id_fkey FOREIGN KEY,\n  CONSTRAINT lessons_pkey PRIMARY KEY,\n  CONSTRAINT lessons_subtopic_id_fkey FOREIGN KEY,\n  CONSTRAINT lessons_topic_id_fkey FOREIGN KEY,\n  CONSTRAINT lessons_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_48908_1_not_null CHECK,\n  CONSTRAINT 2200_48908_2_not_null CHECK,\n  CONSTRAINT 2200_48908_6_not_null CHECK\n);\n\n-- Table: sections\nCREATE TABLE IF NOT EXISTS sections (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  name text NOT NULL,\n  class_id uuid,\n  room_no integer,\n  room_location text,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT sections_class_id_fkey FOREIGN KEY,\n  CONSTRAINT sections_pkey PRIMARY KEY,\n  CONSTRAINT 2200_70884_1_not_null CHECK,\n  CONSTRAINT 2200_70884_2_not_null CHECK\n);\n\n-- Table: _health\nCREATE TABLE IF NOT EXISTS _health (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  last_check timestamp with time zone DEFAULT now(),\n  status text DEFAULT 'healthy'::text,\n  CONSTRAINT _health_pkey PRIMARY KEY,\n  CONSTRAINT 2200_30778_1_not_null CHECK\n);\n\n-- Table: section_students\nCREATE TABLE IF NOT EXISTS section_students (\n  section_id uuid NOT NULL,\n  student_id uuid NOT NULL,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT section_students_pkey PRIMARY KEY,\n  CONSTRAINT section_students_section_id_fkey FOREIGN KEY,\n  CONSTRAINT section_students_student_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_70899_1_not_null CHECK,\n  CONSTRAINT 2200_70899_2_not_null CHECK\n);\n\n-- Table: questions\nCREATE TABLE IF NOT EXISTS questions (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  title character varying NOT NULL,\n  content text,\n  type USER-DEFINED NOT NULL,\n  lesson_id uuid NOT NULL,\n  points integer DEFAULT 0,\n  metadata jsonb,\n  order_index integer,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  data jsonb NOT NULL DEFAULT '{}'::jsonb,\n  correct_answer text,\n  user_id uuid,\n  exercise_prompts ARRAY DEFAULT ARRAY[]::jsonb[],\n  CONSTRAINT questions_lesson_id_fkey FOREIGN KEY,\n  CONSTRAINT questions_pkey PRIMARY KEY,\n  CONSTRAINT questions_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_50362_1_not_null CHECK,\n  CONSTRAINT 2200_50362_2_not_null CHECK,\n  CONSTRAINT 2200_50362_4_not_null CHECK,\n  CONSTRAINT 2200_50362_5_not_null CHECK,\n  CONSTRAINT 2200_50362_11_not_null CHECK\n);\n\n-- Table: loading_states\nCREATE TABLE IF NOT EXISTS loading_states (\n  id uuid NOT NULL,\n  component text NOT NULL,\n  status text NOT NULL,\n  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),\n  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),\n  CONSTRAINT loading_states_pkey PRIMARY KEY,\n  CONSTRAINT 2200_45554_1_not_null CHECK,\n  CONSTRAINT 2200_45554_2_not_null CHECK,\n  CONSTRAINT 2200_45554_3_not_null CHECK,\n  CONSTRAINT 2200_45554_4_not_null CHECK,\n  CONSTRAINT 2200_45554_5_not_null CHECK\n);\n\n-- Table: role_settings\nCREATE TABLE IF NOT EXISTS role_settings (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  role_key text NOT NULL,\n  settings jsonb NOT NULL DEFAULT '{}'::jsonb,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT role_settings_pkey PRIMARY KEY,\n  CONSTRAINT role_settings_role_key_key UNIQUE,\n  CONSTRAINT 2200_30286_1_not_null CHECK,\n  CONSTRAINT 2200_30286_2_not_null CHECK,\n  CONSTRAINT 2200_30286_3_not_null CHECK\n);\n\n-- Table: courses\nCREATE TABLE IF NOT EXISTS courses (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  document_id text NOT NULL,\n  title text NOT NULL,\n  description text,\n  image_url text,\n  level numeric,\n  progress integer DEFAULT 0,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  Grades jsonb,\n  MappedGrades ARRAY,\n  CONSTRAINT courses_document_id_key UNIQUE,\n  CONSTRAINT courses_level_key UNIQUE,\n  CONSTRAINT courses_pkey PRIMARY KEY,\n  CONSTRAINT 2200_72334_1_not_null CHECK,\n  CONSTRAINT 2200_72334_2_not_null CHECK,\n  CONSTRAINT 2200_72334_3_not_null CHECK\n);\n\n-- Table: events\nCREATE TABLE IF NOT EXISTS events (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  title text NOT NULL,\n  description text,\n  start_date timestamp with time zone NOT NULL,\n  end_date timestamp with time zone NOT NULL,\n  location text NOT NULL,\n  attendees integer DEFAULT 0,\n  type text NOT NULL,\n  status text NOT NULL,\n  created_by uuid,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  school_id uuid,\n  department text,\n  CONSTRAINT events_created_by_fkey FOREIGN KEY,\n  CONSTRAINT events_department_check CHECK,\n  CONSTRAINT events_pkey PRIMARY KEY,\n  CONSTRAINT events_school_id_fkey FOREIGN KEY,\n  CONSTRAINT events_status_check CHECK,\n  CONSTRAINT events_type_check CHECK,\n  CONSTRAINT 2200_30303_1_not_null CHECK,\n  CONSTRAINT 2200_30303_2_not_null CHECK,\n  CONSTRAINT 2200_30303_4_not_null CHECK,\n  CONSTRAINT 2200_30303_5_not_null CHECK,\n  CONSTRAINT 2200_30303_6_not_null CHECK,\n  CONSTRAINT 2200_30303_8_not_null CHECK,\n  CONSTRAINT 2200_30303_9_not_null CHECK\n);\n\n-- Table: onboarding_tasks\nCREATE TABLE IF NOT EXISTS onboarding_tasks (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  title text NOT NULL,\n  description text,\n  category text NOT NULL,\n  required boolean DEFAULT true,\n  order_index integer NOT NULL,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT onboarding_tasks_category_check CHECK,\n  CONSTRAINT onboarding_tasks_pkey PRIMARY KEY,\n  CONSTRAINT 2200_29588_1_not_null CHECK,\n  CONSTRAINT 2200_29588_2_not_null CHECK,\n  CONSTRAINT 2200_29588_4_not_null CHECK,\n  CONSTRAINT 2200_29588_6_not_null CHECK\n);\n\n-- Table: onboarding_progress\nCREATE TABLE IF NOT EXISTS onboarding_progress (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  school_id uuid,\n  task_id uuid,\n  status text NOT NULL,\n  notes text,\n  completed_by uuid,\n  completed_at timestamp with time zone,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT onboarding_progress_completed_by_fkey FOREIGN KEY,\n  CONSTRAINT onboarding_progress_pkey PRIMARY KEY,\n  CONSTRAINT onboarding_progress_school_id_fkey FOREIGN KEY,\n  CONSTRAINT onboarding_progress_school_id_task_id_key UNIQUE,\n  CONSTRAINT onboarding_progress_status_check CHECK,\n  CONSTRAINT onboarding_progress_task_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_29600_1_not_null CHECK,\n  CONSTRAINT 2200_29600_4_not_null CHECK\n);\n\n-- Table: school_documents\nCREATE TABLE IF NOT EXISTS school_documents (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  school_id uuid,\n  type text NOT NULL,\n  name text NOT NULL,\n  url text NOT NULL,\n  status text NOT NULL,\n  notes text,\n  uploaded_by uuid,\n  reviewed_by uuid,\n  reviewed_at timestamp with time zone,\n  valid_until timestamp with time zone,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT school_documents_pkey PRIMARY KEY,\n  CONSTRAINT school_documents_reviewed_by_fkey FOREIGN KEY,\n  CONSTRAINT school_documents_school_id_fkey FOREIGN KEY,\n  CONSTRAINT school_documents_status_check CHECK,\n  CONSTRAINT school_documents_type_check CHECK,\n  CONSTRAINT school_documents_uploaded_by_fkey FOREIGN KEY,\n  CONSTRAINT 2200_29628_1_not_null CHECK,\n  CONSTRAINT 2200_29628_3_not_null CHECK,\n  CONSTRAINT 2200_29628_4_not_null CHECK,\n  CONSTRAINT 2200_29628_5_not_null CHECK,\n  CONSTRAINT 2200_29628_6_not_null CHECK\n);\n\n-- Table: class_teachers\nCREATE TABLE IF NOT EXISTS class_teachers (\n  class_id uuid NOT NULL,\n  teacher_id uuid NOT NULL,\n  assigned_by uuid,\n  assigned_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT class_teachers_assigned_by_fkey FOREIGN KEY,\n  CONSTRAINT class_teachers_class_id_fkey FOREIGN KEY,\n  CONSTRAINT class_teachers_pkey PRIMARY KEY,\n  CONSTRAINT class_teachers_teacher_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_50609_1_not_null CHECK,\n  CONSTRAINT 2200_50609_2_not_null CHECK\n);\n\n-- Table: class_students\nCREATE TABLE IF NOT EXISTS class_students (\n  class_id uuid NOT NULL,\n  student_id uuid NOT NULL,\n  assigned_by uuid,\n  assigned_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT class_students_assigned_by_fkey FOREIGN KEY,\n  CONSTRAINT class_students_class_id_fkey FOREIGN KEY,\n  CONSTRAINT class_students_pkey PRIMARY KEY,\n  CONSTRAINT class_students_student_id_fkey FOREIGN KEY,\n  CONSTRAINT fk_class_students_student_id FOREIGN KEY,\n  CONSTRAINT 2200_50630_1_not_null CHECK,\n  CONSTRAINT 2200_50630_2_not_null CHECK\n);\n\n-- Table: assigned_content\nCREATE TABLE IF NOT EXISTS assigned_content (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  class_id uuid,\n  content_type character varying NOT NULL,\n  content_id uuid NOT NULL,\n  valid_from timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  valid_until timestamp with time zone DEFAULT (CURRENT_TIMESTAMP + '7 days'::interval),\n  assigned_by uuid,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT assigned_content_assigned_by_fkey FOREIGN KEY,\n  CONSTRAINT assigned_content_class_id_fkey FOREIGN KEY,\n  CONSTRAINT assigned_content_content_type_check CHECK,\n  CONSTRAINT assigned_content_pkey PRIMARY KEY,\n  CONSTRAINT 2200_50651_1_not_null CHECK,\n  CONSTRAINT 2200_50651_3_not_null CHECK,\n  CONSTRAINT 2200_50651_4_not_null CHECK\n);\n\n-- Table: lesson_prerequisites\nCREATE TABLE IF NOT EXISTS lesson_prerequisites (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  lesson_id uuid NOT NULL,\n  prerequisite_lesson_id uuid NOT NULL,\n  CONSTRAINT lesson_prerequisites_lesson_id_fkey FOREIGN KEY,\n  CONSTRAINT lesson_prerequisites_pkey PRIMARY KEY,\n  CONSTRAINT lesson_prerequisites_prerequisite_lesson_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_86159_1_not_null CHECK,\n  CONSTRAINT 2200_86159_2_not_null CHECK,\n  CONSTRAINT 2200_86159_3_not_null CHECK\n);\n\n-- Table: users\nCREATE TABLE IF NOT EXISTS users (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  email character varying NOT NULL,\n  name character varying NOT NULL,\n  role character varying NOT NULL,\n  school_id uuid,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT users_email_key UNIQUE,\n  CONSTRAINT users_pkey PRIMARY KEY,\n  CONSTRAINT users_role_check CHECK,\n  CONSTRAINT 2200_50576_1_not_null CHECK,\n  CONSTRAINT 2200_50576_2_not_null CHECK,\n  CONSTRAINT 2200_50576_3_not_null CHECK,\n  CONSTRAINT 2200_50576_4_not_null CHECK\n);\n\n-- Table: classes\nCREATE TABLE IF NOT EXISTS classes (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  name character varying NOT NULL,\n  description text,\n  grade_id uuid,\n  created_by uuid,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  section text,\n  CONSTRAINT classes_created_by_fkey FOREIGN KEY,\n  CONSTRAINT classes_grade_id_fkey FOREIGN KEY,\n  CONSTRAINT classes_pkey PRIMARY KEY,\n  CONSTRAINT 2200_50589_1_not_null CHECK,\n  CONSTRAINT 2200_50589_2_not_null CHECK\n);\n\n-- Table: user_permissions\nCREATE TABLE IF NOT EXISTS user_permissions (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  user_id uuid NOT NULL,\n  permissions jsonb NOT NULL DEFAULT '{\"content_editor\": false, \"content_management\": false}'::jsonb,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT user_permissions_pkey PRIMARY KEY,\n  CONSTRAINT user_permissions_user_id_fkey FOREIGN KEY,\n  CONSTRAINT user_permissions_user_id_key UNIQUE,\n  CONSTRAINT 2200_46742_1_not_null CHECK,\n  CONSTRAINT 2200_46742_2_not_null CHECK,\n  CONSTRAINT 2200_46742_3_not_null CHECK\n);\n\n-- Table: event_notifications\nCREATE TABLE IF NOT EXISTS event_notifications (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  event_id uuid,\n  user_id uuid,\n  type text NOT NULL,\n  message text NOT NULL,\n  read boolean DEFAULT false,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT event_notifications_event_id_fkey FOREIGN KEY,\n  CONSTRAINT event_notifications_pkey PRIMARY KEY,\n  CONSTRAINT event_notifications_type_check CHECK,\n  CONSTRAINT event_notifications_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_30338_1_not_null CHECK,\n  CONSTRAINT 2200_30338_4_not_null CHECK,\n  CONSTRAINT 2200_30338_5_not_null CHECK\n);\n\n-- Table: user_preference\nCREATE TABLE IF NOT EXISTS user_preference (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  user_id uuid,\n  preferences jsonb NOT NULL DEFAULT '{}'::jsonb,\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT user_preference_pkey PRIMARY KEY,\n  CONSTRAINT user_preference_user_id_fkey FOREIGN KEY,\n  CONSTRAINT user_preference_user_id_key UNIQUE,\n  CONSTRAINT 2200_46960_1_not_null CHECK,\n  CONSTRAINT 2200_46960_3_not_null CHECK\n);\n\n-- Table: activities\nCREATE TABLE IF NOT EXISTS activities (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),\n  lesson_id uuid NOT NULL,\n  title text NOT NULL,\n  description text,\n  type text NOT NULL,\n  content text,\n  updated_at timestamp with time zone DEFAULT timezone('utc'::text, now()),\n  name text NOT NULL,\n  instructions text,\n  data jsonb DEFAULT jsonb_build_object('prompt', '', 'teacherScript', '', 'media', ARRAY[]::text[]),\n  media ARRAY DEFAULT ARRAY[]::jsonb[],\n  order_index bigint NOT NULL,\n  CONSTRAINT activities_lesson_id_fkey FOREIGN KEY,\n  CONSTRAINT activities_pkey PRIMARY KEY,\n  CONSTRAINT activities_type_check CHECK,\n  CONSTRAINT 2200_52772_1_not_null CHECK,\n  CONSTRAINT 2200_52772_2_not_null CHECK,\n  CONSTRAINT 2200_52772_3_not_null CHECK,\n  CONSTRAINT 2200_52772_4_not_null CHECK,\n  CONSTRAINT 2200_52772_6_not_null CHECK,\n  CONSTRAINT 2200_52772_9_not_null CHECK,\n  CONSTRAINT 2200_52772_13_not_null CHECK\n);\n\n-- Table: event_attendees\nCREATE TABLE IF NOT EXISTS event_attendees (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  event_id uuid,\n  user_id uuid,\n  status text NOT NULL,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT event_attendees_event_id_fkey FOREIGN KEY,\n  CONSTRAINT event_attendees_event_id_user_id_key UNIQUE,\n  CONSTRAINT event_attendees_pkey PRIMARY KEY,\n  CONSTRAINT event_attendees_status_check CHECK,\n  CONSTRAINT event_attendees_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_30406_1_not_null CHECK,\n  CONSTRAINT 2200_30406_4_not_null CHECK\n);\n\n-- Table: lesson_progress\nCREATE TABLE IF NOT EXISTS lesson_progress (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  lesson_id uuid NOT NULL,\n  student_id uuid NOT NULL,\n  status text NOT NULL,\n  completed_at timestamp with time zone,\n  last_activity_id uuid,\n  progress_data jsonb DEFAULT '{}'::jsonb,\n  progress integer DEFAULT 0,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  completed_questions ARRAY,\n  CONSTRAINT lesson_progress_lesson_id_fkey FOREIGN KEY,\n  CONSTRAINT lesson_progress_pkey PRIMARY KEY,\n  CONSTRAINT lesson_progress_student_id_fkey FOREIGN KEY,\n  CONSTRAINT status_check CHECK,\n  CONSTRAINT 2200_86140_1_not_null CHECK,\n  CONSTRAINT 2200_86140_2_not_null CHECK,\n  CONSTRAINT 2200_86140_3_not_null CHECK,\n  CONSTRAINT 2200_86140_4_not_null CHECK\n);\n\n-- Table: event_reminders\nCREATE TABLE IF NOT EXISTS event_reminders (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  event_id uuid,\n  user_id uuid,\n  remind_at timestamp with time zone NOT NULL,\n  sent boolean DEFAULT false,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT event_reminders_event_id_fkey FOREIGN KEY,\n  CONSTRAINT event_reminders_pkey PRIMARY KEY,\n  CONSTRAINT event_reminders_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_30429_1_not_null CHECK,\n  CONSTRAINT 2200_30429_4_not_null CHECK\n);\n\n-- Table: documents\nCREATE TABLE IF NOT EXISTS documents (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  name text NOT NULL,\n  type text NOT NULL,\n  url text NOT NULL,\n  size integer NOT NULL,\n  mime_type text NOT NULL,\n  tags ARRAY DEFAULT '{}'::text[],\n  created_by uuid,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT documents_created_by_fkey FOREIGN KEY,\n  CONSTRAINT documents_pkey PRIMARY KEY,\n  CONSTRAINT 2200_30568_1_not_null CHECK,\n  CONSTRAINT 2200_30568_2_not_null CHECK,\n  CONSTRAINT 2200_30568_3_not_null CHECK,\n  CONSTRAINT 2200_30568_4_not_null CHECK,\n  CONSTRAINT 2200_30568_5_not_null CHECK,\n  CONSTRAINT 2200_30568_6_not_null CHECK\n);\n\n-- Table: notifications\nCREATE TABLE IF NOT EXISTS notifications (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  user_id uuid,\n  type text NOT NULL,\n  title text NOT NULL,\n  message text NOT NULL,\n  read boolean DEFAULT false,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT notifications_pkey PRIMARY KEY,\n  CONSTRAINT notifications_type_check CHECK,\n  CONSTRAINT notifications_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_30469_1_not_null CHECK,\n  CONSTRAINT 2200_30469_3_not_null CHECK,\n  CONSTRAINT 2200_30469_4_not_null CHECK,\n  CONSTRAINT 2200_30469_5_not_null CHECK\n);\n\n-- Table: reports\nCREATE TABLE IF NOT EXISTS reports (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  type text NOT NULL,\n  status text NOT NULL,\n  config jsonb NOT NULL DEFAULT '{}'::jsonb,\n  url text,\n  error text,\n  created_by uuid,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT reports_created_by_fkey FOREIGN KEY,\n  CONSTRAINT reports_pkey PRIMARY KEY,\n  CONSTRAINT reports_status_check CHECK,\n  CONSTRAINT 2200_30486_1_not_null CHECK,\n  CONSTRAINT 2200_30486_2_not_null CHECK,\n  CONSTRAINT 2200_30486_3_not_null CHECK,\n  CONSTRAINT 2200_30486_4_not_null CHECK\n);\n\n-- Table: tasks\nCREATE TABLE IF NOT EXISTS tasks (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  title text NOT NULL,\n  description text,\n  assigned_to uuid,\n  due_date timestamp with time zone NOT NULL,\n  priority text NOT NULL,\n  status text NOT NULL,\n  tags ARRAY DEFAULT '{}'::text[],\n  created_by uuid,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT tasks_assigned_to_fkey FOREIGN KEY,\n  CONSTRAINT tasks_created_by_fkey FOREIGN KEY,\n  CONSTRAINT tasks_pkey PRIMARY KEY,\n  CONSTRAINT tasks_priority_check CHECK,\n  CONSTRAINT tasks_status_check CHECK,\n  CONSTRAINT 2200_30503_1_not_null CHECK,\n  CONSTRAINT 2200_30503_2_not_null CHECK,\n  CONSTRAINT 2200_30503_5_not_null CHECK,\n  CONSTRAINT 2200_30503_6_not_null CHECK,\n  CONSTRAINT 2200_30503_7_not_null CHECK\n);\n\n-- Table: analytics_metrics\nCREATE TABLE IF NOT EXISTS analytics_metrics (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  name text NOT NULL,\n  value numeric NOT NULL,\n  unit text NOT NULL,\n  category text NOT NULL,\n  tags jsonb DEFAULT '{}'::jsonb,\n  timestamp timestamp with time zone DEFAULT now(),\n  CONSTRAINT analytics_metrics_pkey PRIMARY KEY,\n  CONSTRAINT 2200_30526_1_not_null CHECK,\n  CONSTRAINT 2200_30526_2_not_null CHECK,\n  CONSTRAINT 2200_30526_3_not_null CHECK,\n  CONSTRAINT 2200_30526_4_not_null CHECK,\n  CONSTRAINT 2200_30526_5_not_null CHECK\n);\n\n-- Table: messages\nCREATE TABLE IF NOT EXISTS messages (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  sender_id uuid,\n  recipient_id uuid,\n  subject text NOT NULL,\n  content text NOT NULL,\n  read boolean DEFAULT false,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT messages_pkey PRIMARY KEY,\n  CONSTRAINT messages_recipient_id_fkey FOREIGN KEY,\n  CONSTRAINT messages_sender_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_30536_1_not_null CHECK,\n  CONSTRAINT 2200_30536_4_not_null CHECK,\n  CONSTRAINT 2200_30536_5_not_null CHECK\n);\n\n-- Table: message_threads\nCREATE TABLE IF NOT EXISTS message_threads (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  participants ARRAY NOT NULL,\n  subject text NOT NULL,\n  last_message_at timestamp with time zone DEFAULT now(),\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT message_threads_pkey PRIMARY KEY,\n  CONSTRAINT 2200_30557_1_not_null CHECK,\n  CONSTRAINT 2200_30557_2_not_null CHECK,\n  CONSTRAINT 2200_30557_3_not_null CHECK\n);\n\n-- Table: audit_logs\nCREATE TABLE IF NOT EXISTS audit_logs (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  user_id uuid,\n  action text NOT NULL,\n  details jsonb DEFAULT '{}'::jsonb,\n  created_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT audit_logs_pkey PRIMARY KEY,\n  CONSTRAINT 2200_40518_1_not_null CHECK,\n  CONSTRAINT 2200_40518_3_not_null CHECK\n);\n\n-- Table: branches\nCREATE TABLE IF NOT EXISTS branches (\n  id uuid NOT NULL DEFAULT uuid_generate_v4(),\n  name text NOT NULL,\n  school_id uuid,\n  location jsonb NOT NULL DEFAULT '{\"city\": \"\", \"state\": \"\", \"address\": \"\", \"country\": \"\", \"postalCode\": \"\", \"coordinates\": {\"latitude\": 0, \"longitude\": 0}}'::jsonb,\n  latitude double precision NOT NULL DEFAULT 0,\n  longitude double precision NOT NULL DEFAULT 0,\n  contact_number text NOT NULL DEFAULT ''::text,\n  email text NOT NULL DEFAULT ''::text,\n  status USER-DEFINED NOT NULL DEFAULT 'active'::school_status,\n  capacity jsonb NOT NULL DEFAULT '{\"total\": 0, \"current\": 0}'::jsonb,\n  administration jsonb NOT NULL DEFAULT '{\"principalName\": \"\", \"principalEmail\": \"\", \"principalPhone\": \"\", \"administrativeStaff\": []}'::jsonb,\n  website text,\n  established_year integer,\n  accreditation_status text,\n  facilities ARRAY DEFAULT '{}'::text[],\n  operating_hours jsonb NOT NULL DEFAULT '{\"friday\": {\"open\": \"8:00 AM\", \"close\": \"3:00 PM\"}, \"monday\": {\"open\": \"8:00 AM\", \"close\": \"3:00 PM\"}, \"sunday\": {\"open\": \"Closed\", \"close\": \"Closed\", \"isHoliday\": true}, \"tuesday\": {\"open\": \"8:00 AM\", \"close\": \"3:00 PM\"}, \"saturday\": {\"open\": \"8:00 AM\", \"close\": \"12:00 PM\"}, \"thursday\": {\"open\": \"8:00 AM\", \"close\": \"3:00 PM\"}, \"wednesday\": {\"open\": \"8:00 AM\", \"close\": \"3:00 PM\"}}'::jsonb,\n  social_media jsonb DEFAULT '{\"twitter\": null, \"facebook\": null, \"linkedin\": null, \"instagram\": null}'::jsonb,\n  emergency_contact text,\n  tax_id text,\n  license_number text,\n  last_inspection_date timestamp with time zone,\n  student_count integer DEFAULT 0,\n  staff_count integer DEFAULT 0,\n  classroom_count integer DEFAULT 0,\n  is_boarding boolean DEFAULT false,\n  transportation_provided boolean DEFAULT false,\n  curriculum_type ARRAY DEFAULT '{}'::text[],\n  languages_offered ARRAY DEFAULT '{}'::text[],\n  extracurricular_activities ARRAY DEFAULT '{}'::text[],\n  grades ARRAY DEFAULT '{}'::text[],\n  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,\n  academic_year_start date,\n  academic_year_end date,\n  school_timings jsonb DEFAULT '{\"friday\": {\"end\": \"12:00\", \"start\": \"08:00\"}, \"regular\": {\"end\": \"15:00\", \"start\": \"08:00\"}}'::jsonb,\n  academic_calendar jsonb DEFAULT '{\"terms\": [], \"events\": [], \"holidays\": []}'::jsonb,\n  grade_structure jsonb DEFAULT '{\"high\": {\"grades\": [], \"sections\": []}, \"middle\": {\"grades\": [], \"sections\": []}, \"elementary\": {\"grades\": [], \"sections\": []}}'::jsonb,\n  supported_languages ARRAY DEFAULT '{}'::text[],\n  academic_programs jsonb DEFAULT '{\"gifted\": false, \"regular\": true, \"vocational\": false, \"specialNeeds\": false}'::jsonb,\n  assessment_system jsonb DEFAULT '{\"grading\": \"percentage\", \"passingScore\": 40, \"assessmentTypes\": []}'::jsonb,\n  teaching_methodologies ARRAY DEFAULT '{}'::text[],\n  academic_policies jsonb DEFAULT '{}'::jsonb,\n  class_size_limits jsonb DEFAULT '{\"max\": 30, \"min\": 15}'::jsonb,\n  CONSTRAINT branches_pkey PRIMARY KEY,\n  CONSTRAINT branches_school_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_76138_1_not_null CHECK,\n  CONSTRAINT 2200_76138_2_not_null CHECK,\n  CONSTRAINT 2200_76138_4_not_null CHECK,\n  CONSTRAINT 2200_76138_5_not_null CHECK,\n  CONSTRAINT 2200_76138_6_not_null CHECK,\n  CONSTRAINT 2200_76138_7_not_null CHECK,\n  CONSTRAINT 2200_76138_8_not_null CHECK,\n  CONSTRAINT 2200_76138_9_not_null CHECK,\n  CONSTRAINT 2200_76138_10_not_null CHECK,\n  CONSTRAINT 2200_76138_11_not_null CHECK,\n  CONSTRAINT 2200_76138_16_not_null CHECK\n);\n\n-- Table: calendar_events\nCREATE TABLE IF NOT EXISTS calendar_events (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  user_id uuid,\n  title text NOT NULL,\n  description text,\n  start_time timestamp with time zone NOT NULL,\n  end_time timestamp with time zone NOT NULL,\n  location text,\n  type text NOT NULL,\n  status text NOT NULL,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT calendar_events_pkey PRIMARY KEY,\n  CONSTRAINT calendar_events_status_check CHECK,\n  CONSTRAINT calendar_events_type_check CHECK,\n  CONSTRAINT calendar_events_user_id_fkey FOREIGN KEY,\n  CONSTRAINT 2200_36877_1_not_null CHECK,\n  CONSTRAINT 2200_36877_3_not_null CHECK,\n  CONSTRAINT 2200_36877_5_not_null CHECK,\n  CONSTRAINT 2200_36877_6_not_null CHECK,\n  CONSTRAINT 2200_36877_8_not_null CHECK,\n  CONSTRAINT 2200_36877_9_not_null CHECK\n);\n\n-- New Tables for AI Integration\n\n-- Table: ai_conversations\nCREATE TABLE IF NOT EXISTS ai_conversations (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  student_id uuid NOT NULL,\n  teacher_id uuid,\n  class_id uuid,\n  conversation_type text NOT NULL CHECK (conversation_type IN ('assessment', 'practice', 'feedback')),\n  messages jsonb NOT NULL DEFAULT '[]'::jsonb,\n  metadata jsonb NOT NULL DEFAULT '{\n    \"skillLevel\": \"beginner\",\n    \"languageArea\": \"grammar\"\n  }'::jsonb,\n  feedback jsonb NOT NULL DEFAULT '{\n    \"score\": 0,\n    \"strengths\": [],\n    \"areasToImprove\": [],\n    \"recommendations\": []\n  }'::jsonb,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT ai_conversations_pkey PRIMARY KEY (id),\n  CONSTRAINT ai_conversations_student_id_fkey FOREIGN KEY (student_id) REFERENCES students(id),\n  CONSTRAINT ai_conversations_teacher_id_fkey FOREIGN KEY (teacher_id) REFERENCES users(id),\n  CONSTRAINT ai_conversations_class_id_fkey FOREIGN KEY (class_id) REFERENCES classes(id)\n);\n\n-- Table: ai_generated_content\nCREATE TABLE IF NOT EXISTS ai_generated_content (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  teacher_id uuid NOT NULL,\n  content_type text NOT NULL CHECK (content_type IN ('exercise', 'question', 'lesson', 'prompt')),\n  title text NOT NULL,\n  description text,\n  content jsonb NOT NULL DEFAULT '{}'::jsonb,\n  metadata jsonb NOT NULL DEFAULT '{\n    \"difficulty\": \"beginner\",\n    \"targetAge\": [5, 12],\n    \"languageSkills\": [],\n    \"estimatedDuration\": 0\n  }'::jsonb,\n  usage_stats jsonb NOT NULL DEFAULT '{\n    \"timesUsed\": 0,\n    \"averageScore\": 0,\n    \"studentFeedback\": {\n      \"rating\": 0,\n      \"comments\": []\n    }\n  }'::jsonb,\n  status text NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'published', 'archived')),\n  tags text[] DEFAULT ARRAY[]::text[],\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  last_used_at timestamp with time zone,\n  CONSTRAINT ai_generated_content_pkey PRIMARY KEY (id),\n  CONSTRAINT ai_generated_content_teacher_id_fkey FOREIGN KEY (teacher_id) REFERENCES users(id)\n);\n\n-- Table: student_ai_progress\nCREATE TABLE IF NOT EXISTS student_ai_progress (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  student_id uuid NOT NULL,\n  content_id uuid NOT NULL,\n  progress jsonb NOT NULL DEFAULT '{\n    \"status\": \"not_started\",\n    \"score\": 0,\n    \"attempts\": 0,\n    \"timeSpent\": 0\n  }'::jsonb,\n  performance jsonb NOT NULL DEFAULT '{\n    \"accuracy\": 0,\n    \"speed\": 0,\n    \"consistency\": 0,\n    \"strengths\": [],\n    \"weaknesses\": []\n  }'::jsonb,\n  feedback jsonb NOT NULL DEFAULT '{\n    \"aiSuggestions\": [],\n    \"teacherNotes\": []\n  }'::jsonb,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  completed_at timestamp with time zone,\n  CONSTRAINT student_ai_progress_pkey PRIMARY KEY (id),\n  CONSTRAINT student_ai_progress_student_id_fkey FOREIGN KEY (student_id) REFERENCES students(id),\n  CONSTRAINT student_ai_progress_content_id_fkey FOREIGN KEY (content_id) REFERENCES ai_generated_content(id)\n);\n\n-- Table: ai_content_analytics\nCREATE TABLE IF NOT EXISTS ai_content_analytics (\n  id uuid NOT NULL DEFAULT gen_random_uuid(),\n  content_id uuid NOT NULL,\n  metrics jsonb NOT NULL DEFAULT '{\n    \"totalAttempts\": 0,\n    \"averageScore\": 0,\n    \"completionRate\": 0,\n    \"averageTimeSpent\": 0,\n    \"difficultyRating\": 0\n  }'::jsonb,\n  demographics jsonb NOT NULL DEFAULT '{\n    \"ageGroups\": {},\n    \"skillLevels\": {},\n    \"successRates\": {}\n  }'::jsonb,\n  feedback jsonb NOT NULL DEFAULT '{\n    \"studentRatings\": [],\n    \"teacherRatings\": [],\n    \"comments\": []\n  }'::jsonb,\n  created_at timestamp with time zone DEFAULT now(),\n  updated_at timestamp with time zone DEFAULT now(),\n  CONSTRAINT ai_content_analytics_pkey PRIMARY KEY (id),\n  CONSTRAINT ai_content_analytics_content_id_fkey FOREIGN KEY (content_id) REFERENCES ai_generated_content(id)\n);\n\n-- Create indexes for performance\nCREATE INDEX IF NOT EXISTS idx_ai_conversations_student_id ON ai_conversations(student_id);\nCREATE INDEX IF NOT EXISTS idx_ai_conversations_class_id ON ai_conversations(class_id);\nCREATE INDEX IF NOT EXISTS idx_ai_generated_content_teacher_id ON ai_generated_content(teacher_id);\nCREATE INDEX IF NOT EXISTS idx_ai_generated_content_status ON ai_generated_content(status);\nCREATE INDEX IF NOT EXISTS idx_student_ai_progress_student_id ON student_ai_progress(student_id);\nCREATE INDEX IF NOT EXISTS idx_student_ai_progress_content_id ON student_ai_progress(content_id);\nCREATE INDEX IF NOT EXISTS idx_ai_content_analytics_content_id ON ai_content_analytics(content_id);\n\n-- Add archival policies through PostgreSQL partitioning\nALTER TABLE ai_conversations \n  ADD COLUMN IF NOT EXISTS archived boolean DEFAULT false;\n\nCREATE INDEX IF NOT EXISTS idx_ai_conversations_archived ON ai_conversations(archived);\n\n-- Create a function to automatically archive old conversations\nCREATE OR REPLACE FUNCTION archive_old_conversations()\nRETURNS void AS $$\nBEGIN\n  UPDATE ai_conversations\n  SET archived = true\n  WHERE created_at < NOW() - INTERVAL '90 days'\n    AND archived = false;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Create a scheduled job to run the archival function (requires pg_cron extension)\n-- Note: This needs to be run by a superuser\n-- SELECT cron.schedule('0 0 * * *', $$SELECT archive_old_conversations()$$);\n\n"
        }
    ]
}