{
    "sourceFile": "src/lib/auth/strategies/LoadingStrategy.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1739006272486,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1739006286022,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n   }\r\n \r\n   public end(error?: Error): void {\r\n     if (this.loadingId) {\r\n-      loadingMonitor.endLoading(this.loadingId, error);\r\n+      monitors.loadingMonitor.endLoading(this.loadingId, error);\r\n       this.loadingId = undefined;\r\n     }\r\n   }\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1739006309510,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -36,9 +36,9 @@\n   }\r\n \r\n   public end(error?: Error): void {\r\n     if (this.loadingId) {\r\n-      monitors.loadingMonitor.endLoading(this.loadingId, error);\r\n+      monitors.loadingMonitor.endLoading(this.loadingId);\r\n       this.loadingId = undefined;\r\n     }\r\n   }\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1739006346607,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -38,7 +38,9 @@\n   public end(error?: Error): void {\r\n     if (this.loadingId) {\r\n       monitors.loadingMonitor.endLoading(this.loadingId);\r\n       this.loadingId = undefined;\r\n+\r\n     }\r\n+\r\n   }\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1739025316561,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,16 +21,9 @@\n     const duration = performance.now() - this.startTime;\r\n     \r\n     if (!this.warned && duration > this.SLOW_THRESHOLD) {\r\n       if (warningCache.shouldLog(`slow:${this.component}`)) {\r\n-        logger.debug(`Loading progress: ${percent}%`, {\r\n-          context: { \r\n-            component: this.component,\r\n-            duration,\r\n-            threshold: this.SLOW_THRESHOLD\r\n-          },\r\n-          source: this.component\r\n-        });\r\n+        logger.debug(`Loading progress: ${percent}% - Duration: ${duration}ms (threshold: ${this.SLOW_THRESHOLD}ms)`, this.component);\r\n       }\r\n       this.warned = true;\r\n     }\r\n   }\r\n"
                },
                {
                    "date": 1739216713294,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,39 +1,91 @@\n import { logger } from '../../logger';\r\n import { monitors } from '../../monitoring';\r\n import { WarningCache } from '../../monitoring/WarningCache';\r\n \r\n-const warningCache = new WarningCache(5000); // Reduced to 5 seconds\r\n+const warningCache = new WarningCache(5000); // 5 seconds cache\r\n \r\n export class LoadingStrategy {\r\n   private loadingId?: string;\r\n   private startTime: number = 0;\r\n-  private readonly SLOW_THRESHOLD = 1000; // Reduced to 1 second\r\n+  private readonly SLOW_THRESHOLD = 1000; // 1 second threshold\r\n   private warned = false;\r\n+  private isLoading = false;\r\n+  private progressCallbacks: ((progress: number) => void)[] = [];\r\n \r\n   constructor(private component: string) {}\r\n \r\n   public async start(): Promise<void> {\r\n+    if (this.isLoading) {\r\n+      logger.debug(`Loading already in progress for ${this.component}`, this.component);\r\n+      return;\r\n+    }\r\n+\r\n+    this.isLoading = true;\r\n     this.startTime = performance.now();\r\n+    this.warned = false;\r\n     this.loadingId = await monitors.loadingMonitor.startLoading(this.component);\r\n+    \r\n+    logger.debug(`Loading started for ${this.component}`, this.component);\r\n   }\r\n \r\n   public updateProgress(percent: number): void {\r\n+    if (!this.isLoading) return;\r\n+\r\n     const duration = performance.now() - this.startTime;\r\n     \r\n+    // Notify progress callbacks\r\n+    this.progressCallbacks.forEach(callback => callback(percent));\r\n+    \r\n     if (!this.warned && duration > this.SLOW_THRESHOLD) {\r\n       if (warningCache.shouldLog(`slow:${this.component}`)) {\r\n-        logger.debug(`Loading progress: ${percent}% - Duration: ${duration}ms (threshold: ${this.SLOW_THRESHOLD}ms)`, this.component);\r\n+        logger.debug(\r\n+          `Loading progress: ${percent}% - Duration: ${duration}ms (threshold: ${this.SLOW_THRESHOLD}ms)`,\r\n+          this.component\r\n+        );\r\n       }\r\n       this.warned = true;\r\n     }\r\n   }\r\n \r\n+  public onProgress(callback: (progress: number) => void): void {\r\n+    this.progressCallbacks.push(callback);\r\n+  }\r\n+\r\n+  public removeProgressCallback(callback: (progress: number) => void): void {\r\n+    this.progressCallbacks = this.progressCallbacks.filter(cb => cb !== callback);\r\n+  }\r\n+\r\n   public end(error?: Error): void {\r\n+    if (!this.isLoading) return;\r\n+\r\n     if (this.loadingId) {\r\n       monitors.loadingMonitor.endLoading(this.loadingId);\r\n       this.loadingId = undefined;\r\n+    }\r\n \r\n+    const duration = performance.now() - this.startTime;\r\n+    \r\n+    if (error) {\r\n+      logger.error(\r\n+        `Loading failed for ${this.component} after ${duration}ms: ${error.message}`,\r\n+        this.component\r\n+      );\r\n+    } else {\r\n+      logger.debug(\r\n+        `Loading completed for ${this.component} in ${duration}ms`,\r\n+        this.component\r\n+      );\r\n     }\r\n \r\n+    this.isLoading = false;\r\n+    this.progressCallbacks = [];\r\n   }\r\n+\r\n+  public isActive(): boolean {\r\n+    return this.isLoading;\r\n+  }\r\n+\r\n+  public getDuration(): number {\r\n+    return this.isLoading ? performance.now() - this.startTime : 0;\r\n+  }\r\n }\n\\ No newline at end of file\n"
                },
                {
                    "date": 1739279082295,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,18 +15,18 @@\n   constructor(private component: string) {}\r\n \r\n   public async start(): Promise<void> {\r\n     if (this.isLoading) {\r\n-      logger.debug(`Loading already in progress for ${this.component}`, this.component);\r\n+      logger.debug(`Loading already in progress for ${this.component}`, { source: 'LoadingStrategy' });\r\n       return;\r\n     }\r\n \r\n     this.isLoading = true;\r\n     this.startTime = performance.now();\r\n     this.warned = false;\r\n     this.loadingId = await monitors.loadingMonitor.startLoading(this.component);\r\n     \r\n-    logger.debug(`Loading started for ${this.component}`, this.component);\r\n+    logger.debug(`Loading started for ${this.component}`, { source: 'LoadingStrategy' });\r\n   }\r\n \r\n   public updateProgress(percent: number): void {\r\n     if (!this.isLoading) return;\r\n@@ -39,9 +39,9 @@\n     if (!this.warned && duration > this.SLOW_THRESHOLD) {\r\n       if (warningCache.shouldLog(`slow:${this.component}`)) {\r\n         logger.debug(\r\n           `Loading progress: ${percent}% - Duration: ${duration}ms (threshold: ${this.SLOW_THRESHOLD}ms)`,\r\n-          this.component\r\n+          { source: 'LoadingStrategy' }\r\n         );\r\n       }\r\n       this.warned = true;\r\n     }\r\n@@ -67,9 +67,9 @@\n     \r\n     if (error) {\r\n       logger.error(\r\n         `Loading failed for ${this.component} after ${duration}ms: ${error.message}`,\r\n-        this.component\r\n+        { source: this.component }\r\n       );\r\n     } else {\r\n       logger.debug(\r\n         `Loading completed for ${this.component} in ${duration}ms`,\r\n"
                },
                {
                    "date": 1739279119928,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,18 +15,18 @@\n   constructor(private component: string) {}\r\n \r\n   public async start(): Promise<void> {\r\n     if (this.isLoading) {\r\n-      logger.debug(`Loading already in progress for ${this.component}`, { source: 'LoadingStrategy' });\r\n+      logger.debug(`Loading already in progress for ${this.component}`, { source: this.component });\r\n       return;\r\n     }\r\n \r\n     this.isLoading = true;\r\n     this.startTime = performance.now();\r\n     this.warned = false;\r\n     this.loadingId = await monitors.loadingMonitor.startLoading(this.component);\r\n     \r\n-    logger.debug(`Loading started for ${this.component}`, { source: 'LoadingStrategy' });\r\n+    logger.debug(`Loading started for ${this.component}`, { source: this.component });\r\n   }\r\n \r\n   public updateProgress(percent: number): void {\r\n     if (!this.isLoading) return;\r\n@@ -39,9 +39,9 @@\n     if (!this.warned && duration > this.SLOW_THRESHOLD) {\r\n       if (warningCache.shouldLog(`slow:${this.component}`)) {\r\n         logger.debug(\r\n           `Loading progress: ${percent}% - Duration: ${duration}ms (threshold: ${this.SLOW_THRESHOLD}ms)`,\r\n-          { source: 'LoadingStrategy' }\r\n+          { source: this.component }\r\n         );\r\n       }\r\n       this.warned = true;\r\n     }\r\n@@ -72,9 +72,9 @@\n       );\r\n     } else {\r\n       logger.debug(\r\n         `Loading completed for ${this.component} in ${duration}ms`,\r\n-        this.component\r\n+        { source: this.component }\r\n       );\r\n     }\r\n \r\n     this.isLoading = false;\r\n"
                }
            ],
            "date": 1739006272486,
            "name": "Commit-0",
            "content": "import { logger } from '../../logger';\r\nimport { monitors } from '../../monitoring';\r\nimport { WarningCache } from '../../monitoring/WarningCache';\r\n\r\nconst warningCache = new WarningCache(5000); // Reduced to 5 seconds\r\n\r\nexport class LoadingStrategy {\r\n  private loadingId?: string;\r\n  private startTime: number = 0;\r\n  private readonly SLOW_THRESHOLD = 1000; // Reduced to 1 second\r\n  private warned = false;\r\n\r\n  constructor(private component: string) {}\r\n\r\n  public async start(): Promise<void> {\r\n    this.startTime = performance.now();\r\n    this.loadingId = await monitors.loadingMonitor.startLoading(this.component);\r\n  }\r\n\r\n  public updateProgress(percent: number): void {\r\n    const duration = performance.now() - this.startTime;\r\n    \r\n    if (!this.warned && duration > this.SLOW_THRESHOLD) {\r\n      if (warningCache.shouldLog(`slow:${this.component}`)) {\r\n        logger.debug(`Loading progress: ${percent}%`, {\r\n          context: { \r\n            component: this.component,\r\n            duration,\r\n            threshold: this.SLOW_THRESHOLD\r\n          },\r\n          source: this.component\r\n        });\r\n      }\r\n      this.warned = true;\r\n    }\r\n  }\r\n\r\n  public end(error?: Error): void {\r\n    if (this.loadingId) {\r\n      loadingMonitor.endLoading(this.loadingId, error);\r\n      this.loadingId = undefined;\r\n    }\r\n  }\r\n}"
        }
    ]
}